<%
var page = {
  title: 'Room'
}
%>


<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Room</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
        <div id="room-time" class="room-time"></div>
        <div id="rooms">
            <h1>Rooms</h1>
            <ul id="rooms">
            <%
            for (const calName in calendar ) {
                const cal = calendar[calName]
                var count = 0
                for (const room in cal.rooms) {
                    const entries = cal.rooms[room]
                    %>
                <li><a href="#<%= calName %>-<%= count %>"><%= calName %> - <%= room %></a></li><%
                    count += 1
                }
            }
            %>
            </ul>
        </div>
        <div>
            <%
            for (const calName in calendar ) {
                const cal = calendar[calName]
                var count = 0.
                for (const room in cal.rooms) {
                    const entries = cal.rooms[room]
                    %>
                <ul id="list-<%= calName + '-' + count %>" class="room-list">
                    <li class="room-entry-closed room-entry-notstarted">Closed</li>
                    <%
                    var formerEnd;
                    for (const entry of entries) {
                        const speaker = speakers[entry.person]
                        const slots = cal.toSlots()
                        const slotClasses = new Map()
                        function hh (time) {
                            return momentTz(time).tz(slots.tz).format('H:mm')
                        }
                        if (formerEnd && entry.start > formerEnd) { %>
                    <li data-start="<%= momentTz(formerEnd).tz('Asia/Tokyo').toISOString() %>">Break</li><%
                        }
                        %>
                    <li data-start="<%= momentTz(entry.start).tz('Asia/Tokyo').toISOString() %>">
                        <p><%=`${room} ${hh(entry.start)} - ${hh(entry.end)}`%></p>
                        <hr/>
                        <h3><%= entry.summary %></h3>
                        <p><%= entry.description %></p>
                        <hr/>
                        <% if(entry.person){%>
                            <img src="img/speakers/pic-<%=entry.person%>.jpg"/>
                        <%}%>
                        <% if (speaker) {
                            const bio = speaker.biography %>
                            <% if(speaker){%>
                                <p><%= bio %></p>
                            <%}%>
                            <%} %>
                    </li><%
                        formerEnd = entry.end
                    }
                %>  
                    <li class="room-entry-closed room-entry-finished">Closed</li>
                </ul><%
                    count += 1
                }
            }%>    
            </div>
    </body>
  <script src="main.js"></script>
</html>

